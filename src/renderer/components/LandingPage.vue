<template>
    <div class="layout">
        <Layout>

            <Layout>
                <Sider hide-trigger :style="{background: '#fff'}">
                    <file-tree @on-select-change="onFileSelect"></file-tree>
                </Sider>
                <Layout>
                    <Content :style="{padding: '24px', minHeight: '280px', background: '#fff'}">
                        <code-panel></code-panel>
                    </Content>
                    <Layout>
                        <Tabs type="card" :animated="false">
                            <TabPane label="LOGS">{{log}}</TabPane>
                            <TabPane label="BYTECODE">
                                {{bytecode}}
                                <copy-btn :value="bytecode"></copy-btn>
                            </TabPane>
                            <TabPane label="ABI">
                                <tree-view :data="abi"></tree-view>
                            </TabPane>
                        </Tabs>
                    </Layout>
                </Layout>
                <Sider class="rightPane" width="300">
                    右边功能面板

                    <Button class="compileBtn" type="primary" @click="onCompile">编译</Button>
                    <Select v-model="entry" class="entry-select" placeholder="请选择入口文件">
                        <Option v-for="item in files" :value="item.title" :key="item.id">{{ item.title }}</Option>
                    </Select>
                    <Input v-model="contractName" placeholder="合约名称"></Input>
                    <Button class="deployBtn" type="primary" @click="onDeploy">部署</Button>
                    <Button class="callBtn" type="primary" @click="onCall">调用</Button>
                    <contract-list></contract-list>
                </Sider>

                <!--功能面板预留-->
                <!--<Sider hide-trigger :style="{background: '#fff'}">-->
                <!--</Sider>-->
            </Layout>

        </Layout>
        <!--密码提示框-->
        <Modal :loading="passwordConfirmModalLoading" v-model="passwordConfirmModalVisible" @on-ok="onPasswordOk">
            <Input v-model="tempPwd" title="解锁钱包" placeholder="请输入密码"/>
        </Modal>
        <!--部署确认提示-->
        <Modal
                class="confirmDeployModal"
                v-model="confirmDeployModalVisible"
                title="部署确认"
                @on-ok="onDeployOk"
                @on-cancel="onDeployCancel">
            <p>合约名称:{{contractName}}</p>
            <p>部署账户:{{currentWallet.account}}</p>
            <p>手续费类型:GXS</p>
            <p>部署费用:{{fee}}</p>
        </Modal>
    </div>
</template>

<script>
    import SystemInformation from './LandingPage/SystemInformation'
    import FileTree from './common/FileTree'
    import CodePanel from './LandingPage/CodePanel'
    import CopyBtn from '@/components/common/CopyBtn.vue'
    import ContractList from './LandingPage/ContractList'
    import AdmZip from 'adm-zip'
    import {mapState, mapActions} from 'vuex'
    import {
        call_contract,
        deploy_contract,
        unlock_wallet
    } from '@/services/WalletService'
    // import {ops} from 'gxbjs/es/index.js'
    // import {types} from 'gxbjs/es/index.js'

    export default {
        name: 'landing-page',
        data() {
            return {
                passwordConfirmModalLoading: true,
                deployTransaction: null,
                passwordConfirmModalVisible: false,
                confirmDeployModalVisible: false,
                contractName: '',
                currentFee: {},
                entry: '',
                bytecode: '',
                abi: '',
                log: '',
                networkPoint: '',
                networkPoints: [
                    {
                        title: '线上网络',
                        id: 0,
                        value: 0
                    },
                    {
                        title: '测试网络',
                        id: 1,
                        value: 1
                    }
                ],
                // temp
                tempPwd: ''
            }
        },
        created() {
            // console.log(ops.account_name.toHex({user: '1.2.342'}))
            // console.log('pppwekr', ops.abi_def.fromObject(JSON.parse(abi)))
            // setTimeout(() => {
            //     serialize_contract_call_args('lzytest1', 'hi', {
            //         user: 342
            //     }).then(function (ret) {
            //         console.log('suc', ret)
            //     }).catch(ex => {
            //         console.error('fail', ex)
            //     })
            // }, 1000)

            // this.$http('test.json', {
            //     params: {
            //         ID: 12345
            //     }
            // }).then((response) => {
            //     this.onReceiveCompileResult(response.data)
            // })
            //     .catch(function (error) {
            //         console.log('errrrrrrr', error)
            //     })
        },
        mounted() {
            this.setCurrentFee()
            // this.onDeploy()
            // TODO temp test
            this.bytecode = '0061736d0100000001631160037f7e7f0060027f7e0060000060017f0060017e006000017f60027f7f017f60037f7f7f017f60047e7e7e7e017f60027f7f006000017e60047f7e7f7f0060067e7e7e7e7f7f017f60037e7e7e0060047f7f7e7f0060047f7f7f7f0060017f017f0297021003656e760561626f7274000203656e7610616374696f6e5f646174615f73697a65000503656e761063757272656e745f7265636569766572000a03656e760b64625f66696e645f693634000803656e760a64625f6765745f693634000703656e760b64625f6e6578745f693634000603656e760d64625f72656d6f76655f693634000303656e760c64625f73746f72655f693634000c03656e760d64625f7570646174655f693634000b03656e760a6778625f617373657274000903656e76066d656d637079000703656e76067072696e7469000403656e76067072696e7473000303656e76087072696e74735f6c000903656e76077072696e747569000403656e7610726561645f616374696f6e5f646174610006031d1c0606060d000600010601060e0e090f0309090e100610031003030702040501700105050503010001077608066d656d6f72790200165f5a6571524b3131636865636b73756d32353653315f0010165f5a6571524b3131636865636b73756d31363053315f0011165f5a6e65524b3131636865636b73756d31363053315f0012056170706c790013066d616c6c6f63002304667265650026066d656d636d70002a090b010041000b052b161714190ace2e1c0b00200020014120102a450b0b00200020014120102a450b0d00200020014120102a4100470bc10301057f4100410028020441f0006b2207360204024020012000520d00200741d0006a2001370300200741d8006a427f370300200741e0006a4200370300200741e8006a410036020020072001370348200720013703400240024002400240200242ffffffffffffffc93f550d0020024280808a9acde89cc746510d0120024280808a9acde89ca932520d03200741003602342007410136023020072007290330370208200741c0006a200741086a10151a0c030b20024280808080808080ca3f510d0120024280808080808080c0eb00520d022007410036022c2007410236022820072007290328370210200741c0006a200741106a10181a0c020b2007410036023c2007410336023820072007290338370200200741c0006a200710151a0c010b200741003602242007410436022020072007290320370218200741c0006a200741186a10181a0b200741e0006a2802002203450d0002400240200741e4006a220528020022062003460d000340200641686a220628020021042006410036020002402004450d00200410280b20032006470d000b200741e0006a28020021060c010b200321060b20052003360200200610280b4100200741f0006a3602040bb90201067f4100410028020441106b22083602040240200041246a2802002207200041206a2802002203460d00200741686a2106410020036b2104034020062802002903002001510d0120062107200641686a22052106200520046a4168470d000b0b200041086a21050240024002400240024020072003460d00200741686a28020022062802182005464130100920060d010c020b200041086a290300200041106a29030042808080c0f3a9d388322001100322064100480d0120052006101a2206280218200546413010090b20062903082002290300520d01410141e0051009410141900610090240200628021c200841086a100522074100480d0020052007101a1a0b2005200610210c020b41c005100c0c010b2008200236020041014190011009200520062001200810220b4100200841106a3602040b870305037f017e017f017e027f410028020441e0006b22042109410020043602042001280204210220012802002108024002400240024010012203450d002003418104490d012003102321010c020b410021010c020b410020042003410f6a4170716b22013602040b20012003100f1a0b200941186a41106a220642003703002009420037032020094200370318410141a0041009200941186a20014108100a1a200941186a41086a2204200141086a4108100a1a2006200141106a4108100a1a02402003418104490d00200110260b200941306a41086a2201200441086a2903003703002009290318210520092004290300370330200941c0006a41086a200129030037030020092009290330370340200020024101756a210102402002410171450d00200128020020086a28020021080b200941d0006a41086a200941c0006a41086a2903002207370300200941086a41086a20073703002009200929034022073703502009200737030820012005200941086a20081100004100200941e0006a36020441010ba10201067f4100410028020441206b2208360204200820013703180240200041246a2802002207200041206a2802002203460d00200741686a2106410020036b2104034020062802002903002001510d0120062107200641686a22052106200520046a4168470d000b0b200041086a2106024002400240024020072003460d00200741686a28020022052802182006464130100920050d010c020b200041086a290300200041106a29030042808080c0f3a9d388322001100322054100480d0120062005101a2205280218200646413010090b41f000100c2008200236021041014190011009200620054200200841106a101c0c010b200820023602142008200841186a360210200841086a20062001200841106a101b0b4100200841206a3602040b0a004120100c2001100e0bcb0103017f017e037f410028020441106b22042106410020043602042001280204210220012802002105024002400240024010012201450d002001418104490d012001102321040c020b410021040c020b410020042001410f6a4170716b22043602040b20042001100f1a0b20064200370308200641086a20044108100a1a2006290308210302402001418104490d00200410260b200020024101756a210102402002410171450d00200128020020056a28020021050b2001200320051101004100200641106a36020441010b12004110100c2001100e4110100c2001100e0bbc0303037f017e047f410028020441206b220921084100200936020402402000411c6a280200220720002802182202460d00410020026b2103200741686a21060340200641106a2802002001460d0120062107200641686a22042106200420036a4168470d000b0b0240024020072002460d00200741686a28020021060c010b20014100410010042206411f7641017341a00510090240024020064180044d0d002001200610232204200610041a200410260c010b410020092006410f6a4170716b220436020420012004200610041a0b412810272206420037031020064200370308410141a004100920062000360218200620044108100a1a200641086a200441086a4108100a1a200641106a200441106a4108100a1a2006200136021c200820063602182008200629030022053703102008200628021c220736020c024002402000411c6a22012802002204200041206a2802004f0d00200420053703082004200736021020084100360218200420063602002001200441186a3602000c010b200041186a200841186a200841106a2008410c6a101e0b20082802182104200841003602182004450d00200410280b4100200841206a36020420060b940201047f4100410028020441306b220736020420072002370328200129030010025141e003100920072003360214200720013602102007200741286a360218412810272203420037031020034200370308410141a004100920032001360218200741106a2003101d200720033602202007200329030022023703102007200328021c220436020c024002402001411c6a22062802002205200141206a2802004f0d00200520023703082005200436021020074100360220200520033602002006200541186a3602000c010b200141186a200741206a200741106a2007410c6a101e0b2000200336020420002001360200200728022021032007410036022002402003450d00200310280b4100200741306a3602040bf80104017e017f017e017f4100410028020441206b2207360204200128021820004641c0011009200029030010025141f00110092001290300210420032802002203290308200141106a22052903005141b00210092001200129030820032903007c22063703082006428080808080808080405541e00210092001290308428080808080808080c000534180031009200420012903005141a0031009200720014108100a1a2007410872200141086a4108100a1a200741106a20054108100a1a200128021c2002200741181008024020042000290310540d00200041106a427e200442017c2004427d561b3703000b4100200741206a3602040be80103017f017e047f4100410028020441206b2207360204200028020021022000280204220428020421052004280200210641e004100c2006290300100e2005101f20012004280200290300370300200120042802042204290300370308200141106a2205200441086a290300370300200720014108100a1a2007410872200141086a4108100a1a200741106a20054108100a1a2001200229030842808080c0f3a9d3883220002802082903002001290300220320074118100736021c024020032002290310540d00200241106a427e200342017c2003427d561b3703000b4100200741206a3602040baa0301047f024002402000280204200028020022066b41186d220441016a220541abd5aad5004f0d0041aad5aad500210702400240200028020820066b41186d220641d4aad52a4b0d0020052006410174220720072005491b2207450d010b200741186c102721060c020b41002107410021060c010b20001029000b20012802002105200141003602002006200441186c6a2201200536020020012002290300370308200120032802003602102006200741186c6a2104200141186a210502400240200041046a280200220620002802002207460d000340200641686a2202280200210320024100360200200141686a2003360200200141786a200641786a280200360200200141746a200641746a280200360200200141706a200641706a280200360200200141686a21012002210620072002470d000b200041046a2802002107200028020021060c010b200721060b20002001360200200041046a2005360200200041086a2004360200024020072006460d000340200741686a220728020021012007410036020002402001450d00200110280b20062007470d000b0b02402006450d00200610280b0be70105037f017e027f037e017f41002802042202210a420121070240200031000822085022050d00200842017c21094201210703402007420a7e21072009427f7c22094201550d000b0b200041086a210141002002200842017ca7410f6a41f007716b220236020420022008a722036a220641003a000020002903002104024020050d00200842017c2108200420078121092006417f6a2100034020002009420a8142307c3c00002000417f6a21002009420a7f21092008427f7c22084201550d000b0b200420077f100b41f004100c20022003100d418005100c2001410010204100200a3602040b900202017e017f4100410028020441106b220336020402402001450d002000310000100e419005100c0b200320002903002202420888a722003a000f0240200041ff0171450d002003410f6a4101100d20032002421088a722003a000f200041ff0171450d002003410f6a4101100d20032002421888a722003a000f200041ff0171450d002003410f6a4101100d20032002422088a722003a000f200041ff0171450d002003410f6a4101100d20032002422888a722003a000f200041ff0171450d002003410f6a4101100d20032002423088a722003a000f200041ff0171450d002003410f6a4101100d20032002423888a722003a000f2000450d002003410f6a4101100d0b4100200341106a3602040bca0202017e067f200128021820004641a0071009200029030010025141d007100902402000411c6a2205280200220720002802182203460d0020012903002102410020036b2106200741686a2108034020082802002903002002510d0120082107200841686a22042108200420066a4168470d000b0b20072003474190081009200741686a210802400240200720052802002204460d00410020046b2103200821070340200741186a2208280200210620084100360200200728020021042007200636020002402004450d00200410280b200741106a200741286a280200360200200741086a200741206a29030037030020082107200820036a4168470d000b2000411c6a28020022072008460d010b0340200741686a220728020021042007410036020002402004450d00200410280b20082007470d000b0b2000411c6a2008360200200128021c10060bf80104017e017f017e017f4100410028020441206b2207360204200128021820004641c0011009200029030010025141f00110092001290300210420032802002203290308200141106a22052903005141b00610092001200129030820032903007d22063703082006428080808080808080405541e00610092001290308428080808080808080c000534180071009200420012903005141a0031009200720014108100a1a2007410872200141086a4108100a1a200741106a20054108100a1a200128021c2002200741181008024020042000290310540d00200041106a427e200442017c2004427d561b3703000b4100200741206a3602040b090041c808200010240bb904010c7f02402001450d00024020002802c041220d0d004110210d200041c0c1006a41103602000b200141086a200141046a41077122026b200120021b210202400240024020002802c441220a200d4f0d002000200a410c6c6a4180c0006a21010240200a0d0020004184c0006a220d2802000d0020014180c000360200200d20003602000b200241046a210a034002402001280208220d200a6a20012802004b0d002001280204200d6a220d200d28020041808080807871200272360200200141086a22012001280200200a6a360200200d200d28020041808080807872360200200d41046a22010d030b2000102522010d000b0b41fcffffff0720026b2104200041c8c1006a210b200041c0c1006a210c20002802c8412203210d03402000200d410c6c6a22014180c0006a210620014184c0006a280200220541046a210d0340200520062802006a2107200d417c6a2208280200220941ffffffff07712101024020094100480d000240200120024f0d000340200d20016a220a20074f0d01200a280200220a4100480d012001200a41ffffffff07716a41046a22012002490d000b0b20082001200220012002491b200941808080807871723602000240200120024d0d00200d20026a200420016a41ffffffff07713602000b200120024f0d040b200d20016a41046a220d2007490d000b41002101200b4100200b28020041016a220d200d200c280200461b220d360200200d2003470d000b0b20010f0b2008200828020041808080807872360200200d0f0b41000b870501087f20002802c44121010240024041002d00944a450d0041002802984a21070c010b3f002107410041013a00944a4100200741107422073602984a0b200721030240024002400240200741ffff036a41107622023f0022084d0d00200220086b40001a4100210820023f00470d0141002802984a21030b41002108410020033602984a20074100480d0020002001410c6c6a210220074180800441808008200741ffff037122084181f8034922061b6a2008200741ffff077120061b6b20076b2107024041002d00944a0d003f002103410041013a00944a4100200341107422033602984a0b20024180c0006a210220074100480d01200321060240200741076a417871220520036a41ffff036a41107622083f0022044d0d00200820046b40001a20083f00470d0241002802984a21060b4100200620056a3602984a2003417f460d0120002001410c6c6a22014184c0006a2802002206200228020022086a2003460d020240200820014188c0006a22052802002201460d00200620016a2206200628020041808080807871417c20016b20086a72360200200520022802003602002006200628020041ffffffff07713602000b200041c4c1006a2202200228020041016a220236020020002002410c6c6a22004184c0006a200336020020004180c0006a220820073602000b20080f0b02402002280200220820002001410c6c6a22034188c0006a22012802002207460d0020034184c0006a28020020076a2203200328020041808080807871417c20076b20086a72360200200120022802003602002003200328020041ffffffff07713602000b2000200041c4c1006a220728020041016a22033602c0412007200336020041000f0b2002200820076a36020020020b7b01037f024002402000450d0041002802884a22024101480d0041c8c80021032002410c6c41c8c8006a21010340200341046a2802002202450d010240200241046a20004b0d00200220032802006a20004b0d030b2003410c6a22032001490d000b0b0f0b2000417c6a2203200328020041ffffffff07713602000b3f01027f02402000410120001b2201102322020d00034041002102410028029c4a220041003a00002000450d012000110200200110232202450d000b0b20020b0e0002402000450d00200010260b0b05001000000b4901037f4100210502402002450d000240034020002d0000220320012d00002204470d01200141016a2101200041016a21002002417f6a22020d000c020b0b200320046b21050b20050b0300000b0bdf071c0041040b04206500000041100b064279652c20000041200b0848656c6c6f2c20000041300b336f626a6563742070617373656420746f206974657261746f725f746f206973206e6f7420696e206d756c74695f696e646578000041f0000b176f776e65722065786973742c20746f206d6f6469667900004190010b2363616e6e6f74207061737320656e64206974657261746f7220746f206d6f64696679000041c0010b2e6f626a6563742070617373656420746f206d6f64696679206973206e6f7420696e206d756c74695f696e646578000041f0010b3363616e6e6f74206d6f64696679206f626a6563747320696e207461626c65206f6620616e6f7468657220636f6e7472616374000041b0020b2b617474656d707420746f20616464206173736574207769746820646966666572656e742073796d626f6c000041e0020b136164646974696f6e20756e646572666c6f7700004180030b126164646974696f6e206f766572666c6f77000041a0030b3b757064617465722063616e6e6f74206368616e6765207072696d617279206b6579207768656e206d6f64696679696e6720616e206f626a656374000041e0030b3363616e6e6f7420637265617465206f626a6563747320696e207461626c65206f6620616e6f7468657220636f6e7472616374000041a0040b316d61676e6974756465206f6620617373657420616d6f756e74206d757374206265206c657373207468616e20325e3632000041e0040b0d61646462616c616e63652c20000041f0040b022e00004180050b022000004190050b022c000041a0050b176572726f722072656164696e67206974657261746f72000041c0050b126163636f756e74206e6f7420666f756e64000041e0050b2263616e6e6f74207061737320656e64206974657261746f7220746f20657261736500004190060b1e63616e6e6f7420696e6372656d656e7420656e64206974657261746f72000041b0060b30617474656d707420746f207375627472616374206173736574207769746820646966666572656e742073796d626f6c000041e0060b167375627472616374696f6e20756e646572666c6f7700004180070b157375627472616374696f6e206f766572666c6f77000041a0070b2d6f626a6563742070617373656420746f206572617365206973206e6f7420696e206d756c74695f696e646578000041d0070b3263616e6e6f74206572617365206f626a6563747320696e207461626c65206f6620616e6f7468657220636f6e747261637400004190080b35617474656d707420746f2072656d6f7665206f626a656374207468617420776173206e6f7420696e206d756c74695f696e64657800'
            this.abi = `{
  "____comment": "This file was generated by gxb-abigen. DO NOT EDIT - 2018-07-11T08:30:24",
  "version": "gxb::abi/1.0",
  "types": [{
      "new_type_name": "account_name",
      "type": "uint64"
    },{
      "new_type_name": "symbol_name",
      "type": "uint64"
    }
  ],
  "structs": [{
      "name": "subbalance",
      "base": "",
      "fields": [{
          "name": "owner",
          "type": "account_name"
        },{
          "name": "value",
          "type": "asset"
        }
      ]
    },{
      "name": "addbalance",
      "base": "",
      "fields": [{
          "name": "owner",
          "type": "account_name"
        },{
          "name": "value",
          "type": "asset"
        },{
          "name": "ram_payer",
          "type": "account_name"
        }
      ]
    },{
      "name": "getbalance",
      "base": "",
      "fields": [{
          "name": "owner",
          "type": "account_name"
        },{
          "name": "sym",
          "type": "symbol_name"
        }
      ]
    },{
      "name": "hi",
      "base": "",
      "fields": [{
          "name": "user",
          "type": "account_name"
        }
      ]
    },{
      "name": "bye",
      "base": "",
      "fields": [{
          "name": "user",
          "type": "account_name"
        }
      ]
    }
  ],
  "actions": [{
      "name": "subbalance",
      "type": "subbalance",
      "ricardian_contract": ""
    },{
      "name": "addbalance",
      "type": "addbalance",
      "ricardian_contract": ""
    },{
      "name": "getbalance",
      "type": "getbalance",
      "ricardian_contract": ""
    },{
      "name": "hi",
      "type": "hi",
      "ricardian_contract": ""
    },{
      "name": "bye",
      "type": "bye",
      "ricardian_contract": ""
    }
  ],
  "tables": [],
  "ricardian_clauses": [],
  "error_messages": [],
  "abi_extensions": []
}`
            this.abi = JSON.parse(this.abi)
        },
        components: {SystemInformation, FileTree, CodePanel, CopyBtn, ContractList},
        computed: {
            ...mapState('ContractOperation', ['files']),
            ...mapState(['wallets', 'currentWallet', 'assets']),
            fee() {
                if (!this.deployTransaction) {
                    return 0
                } else {
                    return this.deployTransaction.serialize().operations[0][1].fee.amount / Math.pow(10, this.currentFee.precision)
                }
            }
        },
        watch: {
            assets: function () {
                this.setCurrentFee()
            }
        },
        methods: {
            ...mapActions('ContractOperation', ['appendContract']),
            open(link) {
                this.$electron.shell.openExternal(link)
            },
            onClick() {

            },
            onFileSelect(evt) {
                // TODO code panel里面用index，file tree用nodekey，这里进行转换，因为files没有被注入nodekey，考虑优化
                // this.current = evt[0].nodeKey - 1
                console.log('teststtss')
            },
            archiveFiles(entryName) {
                // creating archives
                var zip = new AdmZip()

                // TODO 改this.files
                this.files.forEach(function (file) {
                    zip.addFile(file.title, Buffer.alloc(file.code.length, file.code))
                })

                var entryFile = {
                    name: 'app.json',
                    content: `{"main":"${entryName}"}`
                }

                zip.addFile('app.json', Buffer.alloc(entryFile.content.length, entryFile.content))
                // get everything as a buffer
                return zip.toBuffer()
                // or write everything to disk
                // zip.writeZip('./files.zip')
            },
            onCompile() {
                // 入口文件空判断

                // 压缩文件，调用编译服务
                var buffer = this.archiveFiles(this.entry)

                var data = new FormData()
                data.append('bundle', new Blob([buffer]), 'bundle.zip')
                // var config = {
                //     onUploadProgress: function (progressEvent) {
                //         console.log('progggg', progressEvent)
                //     }
                // }

                const config = {
                    headers: {
                        'Content-Type': 'multipart/form-data'
                    }
                }

                this.$http.post('http://localhost:3000/upload', data, config)
                    .then((res) => {
                        console.log('succccc', res)
                        this.onReceiveCompileResult(res.data)
                    })
                    .catch(function (err) {
                        console.log('errrrr', err)
                    })
            },
            onReceiveCompileResult(res) {
                if (res.status === 'success') {
                    this.renderSuc(res)
                } else {
                    this.renderFail(res)
                }
            },
            renderSuc(res) {
                this.renderLog(res.stdout)
                this.renderBytecode(res.wasm)
                this.renderAbi(res.abi)
                // this.renderLog(res.stdout)
            },
            renderFail(res) {
                console.log(res)
            },
            renderLog(log) {
                this.log = log
            },
            renderBytecode(bytecode) {
                this.bytecode = bytecode
            },
            renderAbi(abi) {
                this.abi = JSON.parse(abi)
                // console.log('kkkkk', JSON.parse(abi))
            },
            onDeploy() {
                this.passwordConfirmModalVisible = true
            },
            onCall() {
                call_contract(this.currentWallet.account, 'pptlzyzy', '1.3.0', '123123', true).then((resp) => {
                    console.log('called', resp)
                }).catch(ex => {
                    console.error('cclclclclclcl', ex)
                })
            },
            onDeployOk() {
                deploy_contract({
                    from: this.currentWallet.account,
                    fee_id: this.currentFee.id,
                    password: this.tempPwd,
                    broadcast: true,
                    abi: this.abi,
                    contractName: this.contractName,
                    code: this.bytecode
                }).then((resp) => {
                    // this.deployTransaction = resp
                    // 将部署过的合约保存在本地
                    console.log('deploy suc', resp)
                    this.appendContract(resp[0].ext)
                }).catch(ex => {
                    console.error('deploy contract fail', ex)
                })
            },
            onDeployCancel() {
                console.log('cacncncncn')
            },
            onPasswordOk() {
                unlock_wallet(this.currentWallet.account, this.tempPwd).then(() => {
                    this.passwordConfirmModalVisible = false
                    this.confirmDeployModalVisible = true
                    return deploy_contract({
                        from: this.currentWallet.account,
                        fee_id: this.currentFee.id,
                        password: this.tempPwd,
                        broadcast: false,
                        abi: this.abi,
                        contractName: this.contractName,
                        code: this.bytecode
                    }).then((resp) => {
                        this.deployTransaction = resp
                    }).catch(ex => {
                        console.error('deploy contract fail', ex)
                    })
                }).catch(ex => {
                    this.$Message.error(ex.message)
                    this.passwordConfirmModalLoading = false
                    this.$nextTick(() => {
                        this.passwordConfirmModalLoading = true
                    })
                })
            },
            setCurrentFee() {
                this.currentFee = this.assets[0]
            }
        }
    }
</script>

<style scoped>
    .ivu-icon-plus {
        color: white;
        font-size: 20px;
    }

    .entry-select {
        width: 200px;
        float: right;
    }

    .network-point {
        width: 200px;
        float: left;
    }

    .compileBtn {

    }

    .rightPane{
        background: white;
    }
</style>
